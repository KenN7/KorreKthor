include ../header.pug

div(class="container page")
    div(class="card mt-2")
        div(class="card-body")
            h4(class="card-title") Examen : #[strong #{exam.name}]
            h6(class="") Statistiques :
            div(class="row")
                ul(class="col-5 ms-4") 
                    li Moyenne : #[strong #{stats.mean}] pts
                    li Variance : #[strong #{stats.var}] pts
                ul(class="col-5")
                    li Participation : #[strong #{stats.participants}] étudiants
                    li Zeros : #[strong #{stats.blancs}] étudiants

                //- ul(class="col-5") 
                //-     li Meilleur question : Question n°#[strong #{stats.bestQuestionNum}] (Nombre de correct : #[strong #{stats.bestQuestionQtt}])
                //-     li Pire question :  Question n°#[strong #{stats.worstQuestionNum}] (Nombre de zero : #[strong #{stats.worstQuestionQtt}])
        
    
    table(class="table table-sm table-hover mt-2")
        thead
            tr
                th Nom
                th Matricule
                th Cote (pts)
        tbody
            each copy in copies 
                - var point = Math.round(((copy.copy.result[0]/copy.copy.result[1])*20)*100)/100
                - var answers = JSON.parse(copy.copy.answers)

                tr(onClick=`getCopyPreview("${ copy.copy.id }")` style="cursor: pointer;")
                    if copy.user.fullName == ""
                        td(class="text-danger") Action requise
                    else
                        td= copy.user.fullName
                    td= copy.user.matricule
                    if "error" in answers
                        th 
                            div(class="text-danger") Error
                    else
                        td #{point}/20

include ../footer.pug    

script.
    function getCopyPreview(id){
        window.location.href = `/see/copy/${id}`
    }